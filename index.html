<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• CASHREF - Ultimate Referral System</title>
    
    <!-- Firebase SDK 9.22.0 -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Font Awesome 7.0.1 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ========== RESET & GLOBAL ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --text-light: #fff;
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* ========== GLASS MORPHISM CARD ========== */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 24px;
            margin: 16px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: fadeInUp 0.6s ease-out;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== AUTH PAGES ========== */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 32px;
            padding: 40px 30px;
            box-shadow: var(--shadow);
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            font-size: 64px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .logo h1 {
            font-size: 32px;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .logo p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e1e1e1;
            border-radius: 16px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            background: var(--primary-gradient);
            color: white;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
        }

        .btn-success {
            background: var(--success-gradient);
        }

        .btn-danger {
            background: var(--warning-gradient);
        }

        .form-toggle {
            text-align: center;
            margin-top: 20px;
            color: var(--text-secondary);
        }

        .form-toggle a {
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
        }

        /* ========== APP CONTAINER ========== */
        .app-container {
            display: none;
            padding-bottom: 100px;
        }

        /* ========== HEADER ========== */
        .app-header {
            padding: 60px 20px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 0 0 40px 40px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        }

        .user-greeting {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .user-email {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ========== BALANCE CARD ========== */
        .balance-card {
            margin-top: -40px;
            position: relative;
            z-index: 10;
            background: white;
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .balance-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
        }

        /* ========== STATS GRID ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .stat-success { color: #43e97b; }
        .stat-warning { color: #fa709a; }
        .stat-info { color: #667eea; }

        /* ========== GUIDE SECTION ========== */
        .guide-section {
            margin: 20px;
            padding: 25px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .guide-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
        }

        .guide-list {
            list-style: none;
        }

        .guide-list li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            color: var(--text-secondary);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .guide-list li:last-child {
            border-bottom: none;
        }

        .guide-list li strong {
            color: var(--text-primary);
        }

        /* ========== REFERRAL PAGE ========== */
        .referral-link-card {
            text-align: center;
            margin: 20px;
            padding: 30px;
        }

        .referral-code {
            background: var(--primary-gradient);
            color: white;
            padding: 20px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 800;
            letter-spacing: 2px;
            margin: 20px 0;
            font-family: monospace;
            cursor: pointer;
            transition: all 0.3s ease;
            word-break: break-all;
        }

        .referral-code:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .share-btn {
            flex: 1;
            padding: 15px;
            border-radius: 16px;
            background: white;
            border: 2px solid #e1e1e1;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .share-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* ========== WITHDRAW PAGE ========== */
        .withdraw-methods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .method-card {
            padding: 15px;
            text-align: center;
            border: 2px solid #e1e1e1;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .method-card.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .method-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: #667eea;
        }

        .method-name {
            font-size: 12px;
            font-weight: 600;
        }

        .withdraw-form {
            margin-top: 20px;
        }

        .amount-input {
            font-size: 32px;
            font-weight: 800;
            text-align: center;
            border: none;
            background: transparent;
            width: 100%;
            color: var(--text-primary);
            margin: 20px 0;
        }

        .amount-input:focus {
            outline: none;
        }

        .amount-input::placeholder {
            color: #ccc;
        }

        .min-withdraw {
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* ========== HISTORY PAGE ========== */
        .history-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .history-info h4 {
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .history-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .history-amount {
            font-size: 20px;
            font-weight: 800;
            color: #43e97b;
        }

        .history-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-success { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }

        /* ========== PROFILE PAGE ========== */
        .profile-section {
            margin-bottom: 30px;
        }

        .profile-info {
            background: white;
            border-radius: 20px;
            padding: 25px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .info-value {
            color: var(--text-primary);
            font-weight: 700;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 10px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        /* ========== BOTTOM NAV ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 16px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .nav-item.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-10px);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
        }

        /* ========== MODAL ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            animation: fadeInUp 0.4s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 800;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 480px) {
            .stats-grid, .referral-stats, .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .withdraw-methods {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .balance-amount {
                font-size: 36px;
            }
            
            .referral-code {
                font-size: 18px;
                padding: 15px;
            }
        }

        /* ========== NOTIFICATION ========== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            animation: slideInRight 0.3s ease-out;
            max-width: 300px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left: 4px solid #43e97b;
        }

        .notification.error {
            border-left: 4px solid #fa709a;
        }

        .notification.info {
            border-left: 4px solid #667eea;
        }

        /* ========== LOADING ========== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- AUTH PAGES -->
    <div id="authPage" class="auth-container">
        <div class="auth-card">
            <!-- LOGIN FORM -->
            <div id="loginForm">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h1>CASHREF</h1>
                    <p>Dapatkan uang dari setiap teman yang bergabung!</p>
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="you@example.com">
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <div class="form-group">
                    <label>Kode Referral (Opsional)</label>
                    <input type="text" id="referralCode" class="form-input" placeholder="Masukkan kode referral teman">
                </div>

                <div id="loginError" style="color: #fa709a; font-size: 14px; margin-bottom: 10px; display: none;"></div>

                <button class="btn" onclick="login()" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span id="loginBtnText">MASUK KE APLIKASI</span>
                </button>

                <div class="form-toggle">
                    Belum punya akun? <a onclick="showRegister()">Daftar akun baru</a>
                </div>
            </div>

            <!-- REGISTER FORM -->
            <div id="registerForm" style="display: none;">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h1>DAFTAR AKUN</h1>
                    <p>Bergabung dan mulai dapatkan komisi!</p>
                </div>

                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="registerEmail" class="form-input" placeholder="you@example.com">
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" class="form-input" placeholder="Minimal 6 karakter">
                </div>

                <div class="form-group">
                    <label>Konfirmasi Password</label>
                    <input type="password" id="registerConfirm" class="form-input" placeholder="Ketik ulang password">
                </div>

                <div class="form-group">
                    <label>Kode Referral (Opsional)</label>
                    <input type="text" id="registerReferral" class="form-input" placeholder="Masukkan kode referral teman">
                </div>

                <div id="registerError" style="color: #fa709a; font-size: 14px; margin-bottom: 10px; display: none;"></div>

                <button class="btn btn-secondary" onclick="register()" id="registerBtn">
                    <i class="fas fa-user-plus"></i>
                    <span id="registerBtnText">BUAT AKUN BARU</span>
                </button>

                <div class="form-toggle">
                    Sudah punya akun? <a onclick="showLogin()">Masuk disini</a>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="appPage" class="app-container">
        <!-- HOME PAGE -->
        <div id="homePage">
            <div class="app-header">
                <div class="user-greeting" id="userGreeting">Halo, User!</div>
                <div class="user-email" id="userEmailDisplay">user@example.com</div>
            </div>

            <div class="balance-card">
                <div class="balance-label">Saldo Anda</div>
                <div class="balance-amount" id="userBalance">Rp0</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-success">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-value" id="referralSuccess">0</div>
                    <div class="stat-label">Referral Berhasil</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-warning">
                        <i class="fas fa-user-times"></i>
                    </div>
                    <div class="stat-value" id="referralFailed">0</div>
                    <div class="stat-label">Referral Gagal</div>
                </div>
            </div>

            <div class="guide-section">
                <div class="guide-title">
                    <i class="fas fa-bullhorn"></i> Panduan Referral
                </div>
                <ul class="guide-list">
                    <li><strong>1.</strong> Daftar akun dengan email valid</li>
                    <li><strong>2.</strong> Dapatkan kode referral unik Anda</li>
                    <li><strong>3.</strong> Bagikan ke teman melalui WhatsApp, Telegram, dll</li>
                    <li><strong>4.</strong> Dapatkan <strong>Rp250</strong> per referral sukses!</li>
                    <li><strong>5.</strong> Teman Anda juga dapat bonus Rp100</li>
                    <li><strong>6.</strong> Minimal penarikan <strong>Rp10.000</strong></li>
                    <li><strong>7.</strong> Tanpa batas referral, unlimited income!</li>
                </ul>
            </div>
        </div>

        <!-- REFERRAL PAGE -->
        <div id="referralPage" style="display: none;">
            <div class="app-header">
                <div class="user-greeting">Program Referral</div>
                <div class="user-email">Dapatkan komisi untuk setiap teman!</div>
            </div>

            <div class="referral-link-card glass-card">
                <div style="margin-bottom: 20px;">
                    <i class="fas fa-gift fa-3x" style="background: var(--primary-gradient); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                </div>
                
                <h3 style="margin-bottom: 10px; color: var(--text-primary);">KODE REFERRAL ANDA</h3>
                
                <div class="referral-code" id="referralCodeDisplay" onclick="copyReferralCode()">
                    LOADING...
                </div>
                
                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">
                    Klik untuk menyalin kode
                </div>

                <div class="referral-stats">
                    <div class="stat-card">
                        <div class="stat-icon stat-success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="referralSuccessPage">0</div>
                        <div class="stat-label">Berhasil</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon stat-warning">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-value" id="referralFailedPage">0</div>
                        <div class="stat-label">Gagal</div>
                    </div>
                </div>

                <div class="share-buttons">
                    <button class="share-btn" onclick="shareViaWhatsApp()">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                    <button class="share-btn" onclick="shareViaTelegram()">
                        <i class="fab fa-telegram"></i> Telegram
                    </button>
                    <button class="share-btn" onclick="copyReferralLink()">
                        <i class="fas fa-copy"></i> Salin Link
                    </button>
                </div>
            </div>

            <div class="guide-section">
                <div class="guide-title">
                    <i class="fas fa-chart-line"></i> Tips Referral
                </div>
                <ul class="guide-list">
                    <li>üîó Bagikan link referral ke grup WhatsApp</li>
                    <li>üì± Posting di story Instagram dengan hashtag</li>
                    <li>üë• Ajak teman dekat untuk bergabung</li>
                    <li>üí∞ Setiap referral sukses = Rp250 untuk Anda!</li>
                    <li>üéÅ Bonus Rp100 untuk teman yang baru daftar</li>
                </ul>
            </div>
        </div>

        <!-- WITHDRAW PAGE -->
        <div id="withdrawPage" style="display: none;">
            <div class="app-header">
                <div class="user-greeting">Tarik Dana</div>
                <div class="user-email">Tarik pendapatan Anda ke e-wallet</div>
            </div>

            <div class="glass-card">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 14px; color: var(--text-secondary);">Saldo Tersedia</div>
                    <div style="font-size: 48px; font-weight: 900; color: #667eea; margin: 10px 0;" id="withdrawBalance">
                        Rp0
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px; color: #856404;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Minimal penarikan: <strong>Rp10.000</strong></span>
                    </div>
                </div>

                <div class="withdraw-methods">
                    <div class="method-card" onclick="selectWithdrawMethod('dana')" id="methodDana">
                        <div class="method-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="method-name">DANA</div>
                    </div>

                    <div class="method-card" onclick="selectWithdrawMethod('shopee')" id="methodShopee">
                        <div class="method-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="method-name">SHOPEE PAY</div>
                    </div>

                    <div class="method-card" onclick="selectWithdrawMethod('bank')" id="methodBank">
                        <div class="method-icon">
                            <i class="fas fa-university"></i>
                        </div>
                        <div class="method-name">BANK</div>
                    </div>
                </div>

                <!-- Dana Form -->
                <div id="danaForm" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label>Nomor DANA</label>
                        <input type="number" id="danaNumber" class="form-input" placeholder="0812xxxxxxx">
                    </div>
                    <div class="form-group">
                        <label>Nama Pemilik DANA</label>
                        <input type="text" id="danaName" class="form-input" placeholder="Nama sesuai di DANA">
                    </div>
                </div>

                <!-- Shopee Form -->
                <div id="shopeeForm" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label>Nomor ShopeePay</label>
                        <input type="number" id="shopeeNumber" class="form-input" placeholder="0812xxxxxxx">
                    </div>
                    <div class="form-group">
                        <label>Nama Pemilik ShopeePay</label>
                        <input type="text" id="shopeeName" class="form-input" placeholder="Nama sesuai di Shopee">
                    </div>
                </div>

                <!-- Bank Form -->
                <div id="bankForm" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label>Nama Bank</label>
                        <select id="bankName" class="form-input">
                            <option value="">Pilih Bank</option>
                            <option value="BCA">BCA</option>
                            <option value="BRI">BRI</option>
                            <option value="BNI">BNI</option>
                            <option value="Mandiri">Mandiri</option>
                            <option value="CIMB">CIMB</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nomor Rekening</label>
                        <input type="number" id="bankNumber" class="form-input" placeholder="1234567890">
                    </div>
                    <div class="form-group">
                        <label>Nama Pemilik Rekening</label>
                        <input type="text" id="bankAccountName" class="form-input" placeholder="Nama sesuai di rekening">
                    </div>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label>Jumlah Penarikan (Rp)</label>
                    <input type="number" id="withdrawAmount" class="form-input amount-input" placeholder="10000">
                </div>

                <div class="min-withdraw">
                    Minimal: Rp10.000
                </div>

                <div id="withdrawError" style="color: #fa709a; font-size: 14px; margin-bottom: 10px; display: none;"></div>
                <div id="withdrawSuccess" style="color: #43e97b; font-size: 14px; margin-bottom: 10px; display: none;"></div>

                <button class="btn btn-success" onclick="submitWithdraw()" id="withdrawBtn">
                    <i class="fas fa-paper-plane"></i>
                    TARIK SEKARANG
                </button>
            </div>
        </div>

        <!-- HISTORY PAGE -->
        <div id="historyPage" style="display: none;">
            <div class="app-header">
                <div class="user-greeting">Riwayat Penarikan</div>
                <div class="user-email">Lihat riwayat penarikan Anda</div>
            </div>

            <div class="glass-card">
                <div class="guide-title" style="margin-bottom: 20px;">
                    <i class="fas fa-history"></i> Riwayat Penarikan
                </div>

                <div class="history-list" id="withdrawalHistory">
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-receipt fa-3x" style="margin-bottom: 20px; opacity: 0.3;"></i>
                        <div>Belum ada riwayat penarikan</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFILE PAGE -->
        <div id="profilePage" style="display: none;">
            <div class="app-header">
                <div class="user-greeting">Profil Akun</div>
                <div class="user-email">Kelola akun dan pengaturan</div>
            </div>

            <div class="glass-card profile-info">
                <div class="info-row">
                    <span class="info-label">Email</span>
                    <span class="info-value" id="profileEmail">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">User ID</span>
                    <div style="display: flex; align-items: center;">
                        <span class="info-value" id="profileUserId" style="font-family: monospace; font-size: 12px;">-</span>
                        <button class="copy-btn" onclick="copyUserId()">
                            <i class="fas fa-copy"></i> Salin
                        </button>
                    </div>
                </div>
                <div class="info-row">
                    <span class="info-label">Tanggal Bergabung</span>
                    <span class="info-value" id="profileJoinDate">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Status Akun</span>
                    <span class="info-value" style="color: #43e97b;" id="profileStatus">Aktif</span>
                </div>
            </div>

            <div class="glass-card" style="margin-top: 20px;">
                <div class="guide-title" style="margin-bottom: 20px;">
                    <i class="fas fa-chart-bar"></i> Statistik
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon stat-success">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="profileReferralSuccess">0</div>
                        <div class="stat-label">Total Referral</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon stat-info">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-value" id="profileTotalEarned">Rp0</div>
                        <div class="stat-label">Total Pendapatan</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="color: #fbbf24;">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-value" id="profileCurrentBalance">Rp0</div>
                        <div class="stat-label">Saldo Saat Ini</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="color: #8b5cf6;">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <div class="stat-value" id="profileTotalWithdrawn">Rp0</div>
                        <div class="stat-label">Total Ditarik</div>
                    </div>
                </div>
            </div>

            <div class="glass-card" style="margin-top: 20px;">
                <div class="guide-title" style="margin-bottom: 20px;">
                    <i class="fas fa-key"></i> Ganti Password
                </div>

                <div class="form-group">
                    <label>Password Lama</label>
                    <input type="password" id="oldPassword" class="form-input" placeholder="Masukkan password lama">
                </div>

                <div class="form-group">
                    <label>Password Baru</label>
                    <input type="password" id="newPassword" class="form-input" placeholder="Minimal 6 karakter">
                </div>

                <div class="form-group">
                    <label>Konfirmasi Password Baru</label>
                    <input type="password" id="confirmNewPassword" class="form-input" placeholder="Ketik ulang password baru">
                </div>

                <div id="passwordError" style="color: #fa709a; font-size: 14px; margin-bottom: 10px; display: none;"></div>
                <div id="passwordSuccess" style="color: #43e97b; font-size: 14px; margin-bottom: 10px; display: none;"></div>

                <button class="btn" onclick="changePassword()">
                    <i class="fas fa-sync-alt"></i>
                    GANTI PASSWORD
                </button>
            </div>

            <div class="glass-card" style="margin-top: 20px; text-align: center;">
                <button class="btn btn-danger" onclick="logout()" style="width: 100%;">
                    <i class="fas fa-sign-out-alt"></i>
                    KELUAR DARI AKUN
                </button>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showPage('homePage')">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-label">HOME</div>
            </div>
            <div class="nav-item" onclick="showPage('referralPage')">
                <div class="nav-icon"><i class="fas fa-user-friends"></i></div>
                <div class="nav-label">REFERRAL</div>
            </div>
            <div class="nav-item" onclick="showPage('withdrawPage')">
                <div class="nav-icon"><i class="fas fa-wallet"></i></div>
                <div class="nav-label">TARIK</div>
            </div>
            <div class="nav-item" onclick="showPage('historyPage')">
                <div class="nav-icon"><i class="fas fa-history"></i></div>
                <div class="nav-label">RIWAYAT</div>
            </div>
            <div class="nav-item" onclick="showPage('profilePage')">
                <div class="nav-icon"><i class="fas fa-user"></i></div>
                <div class="nav-label">PROFILE</div>
            </div>
        </div>
    </div>

    <!-- SHARE MODAL -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-share-alt"></i> Bagikan Referral
                </div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            
            <div style="margin: 20px 0;">
                <input type="text" id="shareableLink" class="form-input" readonly style="font-size: 14px;">
            </div>
            
            <button class="btn" onclick="copyShareLink()">
                <i class="fas fa-copy"></i> SALIN LINK
            </button>
        </div>
    </div>

    <script>
        // üî• FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCf230zCliSZ9EYLByMnmflqw8sOz328Uc",
            authDomain: "database-cupz.firebaseapp.com",
            projectId: "database-cupz",
            storageBucket: "database-cupz.firebasestorage.app",
            messagingSenderId: "343357519412",
            appId: "1:343357519412:web:dce862636c7c459e6a3c61"
        };

        // Initialize Firebase
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log("‚úÖ Firebase initialized");
            }
        } catch (error) {
            console.error("‚ùå Firebase init error:", error);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // üî• STATE VARIABLES
        let currentUser = null;
        let userData = {};
        let userBalance = 0;
        let referralCode = '';
        let selectedWithdrawMethod = null;

        // üî• UTILITY FUNCTIONS
        function formatRupiah(amount) {
            return 'Rp' + amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // üî• AUTH FUNCTIONS
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const refCode = document.getElementById('referralCode').value;
            const btn = document.getElementById('loginBtn');
            const btnText = document.getElementById('loginBtnText');
            const errorDiv = document.getElementById('loginError');

            if (!email || !password) {
                errorDiv.textContent = 'Email dan password harus diisi';
                errorDiv.style.display = 'block';
                return;
            }

            btn.disabled = true;
            btnText.innerHTML = '<div class="loading"></div>';

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Check referral code
                if (refCode) {
                    await processReferral(refCode);
                }

                await loadUserData();
                showApp();
                
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
                btnText.textContent = 'MASUK KE APLIKASI';
                btn.disabled = false;
            }
        }

        async function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirm = document.getElementById('registerConfirm').value;
            const refCode = document.getElementById('registerReferral').value;
            const btn = document.getElementById('registerBtn');
            const btnText = document.getElementById('registerBtnText');
            const errorDiv = document.getElementById('registerError');

            if (!email || !password || !confirm) {
                errorDiv.textContent = 'Semua field harus diisi';
                errorDiv.style.display = 'block';
                return;
            }

            if (password.length < 6) {
                errorDiv.textContent = 'Password minimal 6 karakter';
                errorDiv.style.display = 'block';
                return;
            }

            if (password !== confirm) {
                errorDiv.textContent = 'Password tidak cocok';
                errorDiv.style.display = 'block';
                return;
            }

            btn.disabled = true;
            btnText.innerHTML = '<div class="loading"></div>';

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Generate referral code
                const newRefCode = generateReferralCode();
                
                // Create user data
                await db.collection('users').doc(currentUser.uid).set({
                    email: email,
                    referralCode: newRefCode,
                    balance: 0,
                    referralSuccess: 0,
                    referralFailed: 0,
                    totalEarned: 0,
                    totalWithdrawn: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'active',
                    hasUsedReferral: false
                });

                // Process referral if exists
                if (refCode) {
                    await processReferral(refCode);
                }

                await loadUserData();
                showApp();
                
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
                btnText.textContent = 'BUAT AKUN BARU';
                btn.disabled = false;
            }
        }

        // üî• REFERRAL SYSTEM
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        async function processReferral(refCode) {
            try {
                if (!currentUser) return;

                // Check if already used referral
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists && userDoc.data().hasUsedReferral) {
                    return;
                }

                // Find referrer
                const usersRef = db.collection('users');
                const querySnapshot = await usersRef.where('referralCode', '==', refCode.toUpperCase()).get();
                
                if (querySnapshot.empty) return;

                const referrerDoc = querySnapshot.docs[0];
                const referrerId = referrerDoc.id;
                const referrerData = referrerDoc.data();

                // Check self-referral
                if (referrerId === currentUser.uid) return;

                // Update referrer data
                await db.collection('users').doc(referrerId).update({
                    balance: firebase.firestore.FieldValue.increment(250),
                    referralSuccess: firebase.firestore.FieldValue.increment(1),
                    totalEarned: firebase.firestore.FieldValue.increment(250)
                });

                // Update current user
                await db.collection('users').doc(currentUser.uid).update({
                    balance: firebase.firestore.FieldValue.increment(100),
                    hasUsedReferral: true
                });

                // Log referral
                await db.collection('referrals').add({
                    referrerId: referrerId,
                    referredId: currentUser.uid,
                    referrerEmail: referrerData.email,
                    referredEmail: currentUser.email,
                    referrerBonus: 250,
                    referredBonus: 100,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'success'
                });

                showNotification('success', 'Bonus referral berhasil! +Rp100');
                
            } catch (error) {
                console.error('Referral error:', error);
            }
        }

        // üî• APP FUNCTIONS
        function showApp() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('appPage').style.display = 'block';
            
            updateUserDisplay();
            setupRealtimeListener();
            loadWithdrawalHistory();
        }

        async function loadUserData() {
            if (!currentUser) return;

            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    userBalance = userData.balance || 0;
                    referralCode = userData.referralCode || '';
                    
                    updateUI();
                }
            } catch (error) {
                console.error('Load user data error:', error);
            }
        }

        function setupRealtimeListener() {
            if (!currentUser) return;

            // Listen for user data changes
            db.collection('users').doc(currentUser.uid)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        userData = doc.data();
                        userBalance = userData.balance || 0;
                        updateUI();
                    }
                });

            // Listen for withdrawal status changes
            db.collection('withdrawals')
                .where('userId', '==', currentUser.uid)
                .orderBy('timestamp', 'desc')
                .onSnapshot((snapshot) => {
                    loadWithdrawalHistory();
                });
        }

        function updateUI() {
            if (!currentUser) return;

            // Update balance
            document.getElementById('userBalance').textContent = formatRupiah(userBalance);
            document.getElementById('withdrawBalance').textContent = formatRupiah(userBalance);
            document.getElementById('profileCurrentBalance').textContent = formatRupiah(userBalance);
            document.getElementById('profileTotalEarned').textContent = formatRupiah(userData.totalEarned || 0);
            document.getElementById('profileTotalWithdrawn').textContent = formatRupiah(userData.totalWithdrawn || 0);
            
            // Update referral stats
            document.getElementById('referralSuccess').textContent = userData.referralSuccess || 0;
            document.getElementById('referralFailed').textContent = userData.referralFailed || 0;
            document.getElementById('referralSuccessPage').textContent = userData.referralSuccess || 0;
            document.getElementById('referralFailedPage').textContent = userData.referralFailed || 0;
            document.getElementById('profileReferralSuccess').textContent = userData.referralSuccess || 0;
            
            // Update referral code
            if (referralCode) {
                document.getElementById('referralCodeDisplay').textContent = referralCode;
            }
        }

        function updateUserDisplay() {
            if (!currentUser) return;
            
            const email = currentUser.email;
            const name = email.split('@')[0];
            
            document.getElementById('userGreeting').textContent = `Halo, ${name}!`;
            document.getElementById('userEmailDisplay').textContent = email;
            document.getElementById('profileEmail').textContent = email;
            document.getElementById('profileUserId').textContent = currentUser.uid;
            
            if (userData.createdAt) {
                const date = userData.createdAt.toDate ? userData.createdAt.toDate() : new Date();
                document.getElementById('profileJoinDate').textContent = date.toLocaleDateString('id-ID');
            }
        }

        // üî• WITHDRAWAL FUNCTIONS
        function selectWithdrawMethod(method) {
            selectedWithdrawMethod = method;
            
            // Reset all forms
            document.getElementById('danaForm').style.display = 'none';
            document.getElementById('shopeeForm').style.display = 'none';
            document.getElementById('bankForm').style.display = 'none';
            
            // Reset active class
            document.getElementById('methodDana').classList.remove('active');
            document.getElementById('methodShopee').classList.remove('active');
            document.getElementById('methodBank').classList.remove('active');
            
            // Show selected form
            if (method === 'dana') {
                document.getElementById('danaForm').style.display = 'block';
                document.getElementById('methodDana').classList.add('active');
            } else if (method === 'shopee') {
                document.getElementById('shopeeForm').style.display = 'block';
                document.getElementById('methodShopee').classList.add('active');
            } else if (method === 'bank') {
                document.getElementById('bankForm').style.display = 'block';
                document.getElementById('methodBank').classList.add('active');
            }
        }

        async function submitWithdraw() {
            if (!currentUser) {
                showNotification('error', 'Silakan login terlebih dahulu');
                return;
            }

            if (!selectedWithdrawMethod) {
                showNotification('error', 'Pilih metode penarikan terlebih dahulu');
                return;
            }

            const amountInput = document.getElementById('withdrawAmount').value;
            const amount = parseInt(amountInput);

            if (!amount || amount < 10000) {
                showNotification('error', 'Minimal penarikan Rp10.000');
                return;
            }

            if (amount > userBalance) {
                showNotification('error', 'Saldo tidak mencukupi');
                return;
            }

            // Collect data based on method
            let withdrawData = {
                userId: currentUser.uid,
                userEmail: currentUser.email,
                amount: amount,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending',
                adminApproved: false
            };

            if (selectedWithdrawMethod === 'dana') {
                const danaNumber = document.getElementById('danaNumber').value;
                const danaName = document.getElementById('danaName').value;
                
                if (!danaNumber || !danaName) {
                    showNotification('error', 'Isi semua data DANA');
                    return;
                }
                
                withdrawData.method = 'DANA';
                withdrawData.accountNumber = danaNumber;
                withdrawData.accountName = danaName;
            }
            else if (selectedWithdrawMethod === 'shopee') {
                const shopeeNumber = document.getElementById('shopeeNumber').value;
                const shopeeName = document.getElementById('shopeeName').value;
                
                if (!shopeeNumber || !shopeeName) {
                    showNotification('error', 'Isi semua data ShopeePay');
                    return;
                }
                
                withdrawData.method = 'SHOPEE PAY';
                withdrawData.accountNumber = shopeeNumber;
                withdrawData.accountName = shopeeName;
            }
            else if (selectedWithdrawMethod === 'bank') {
                const bankName = document.getElementById('bankName').value;
                const bankNumber = document.getElementById('bankNumber').value;
                const bankAccountName = document.getElementById('bankAccountName').value;
                
                if (!bankName || !bankNumber || !bankAccountName) {
                    showNotification('error', 'Isi semua data bank');
                    return;
                }
                
                withdrawData.method = bankName;
                withdrawData.accountNumber = bankNumber;
                withdrawData.accountName = bankAccountName;
                withdrawData.bankName = bankName;
            }

            const btn = document.getElementById('withdrawBtn');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="loading"></div>';
            btn.disabled = true;

            try {
                // Add withdrawal request
                const withdrawRef = await db.collection('withdrawals').add(withdrawData);
                
                // Update user balance
                await db.collection('users').doc(currentUser.uid).update({
                    balance: firebase.firestore.FieldValue.increment(-amount)
                });

                // Update local balance
                userBalance -= amount;
                updateUI();

                // Send to admin bot via webhook
                await sendToAdminBot(withdrawData, withdrawRef.id);

                showNotification('success', 
                    `‚úÖ PENARIKAN DIAJUKAN!\n` +
                    `üí∞ Rp${amount.toLocaleString('id-ID')}\n` +
                    `‚è∞ Akan diproses admin dalam 1x24 jam`
                );

                // Reset form
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('danaNumber').value = '';
                document.getElementById('danaName').value = '';
                document.getElementById('shopeeNumber').value = '';
                document.getElementById('shopeeName').value = '';
                document.getElementById('bankName').value = '';
                document.getElementById('bankNumber').value = '';
                document.getElementById('bankAccountName').value = '';
                
                // Reload history
                loadWithdrawalHistory();

            } catch (error) {
                console.error('Withdraw error:', error);
                showNotification('error', 'Gagal mengajukan penarikan');
            } finally {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
            }
        }

        async function sendToAdminBot(withdrawData, withdrawId) {
            try {
                // This would send to your Telegram bot webhook
                const message = `
üìã PENARIKAN BARU
üÜî ID: ${withdrawId}
üë§ User: ${withdrawData.userEmail}
üí∞ Amount: Rp${withdrawData.amount}
üì± Method: ${withdrawData.method}
üè¶ Account: ${withdrawData.accountNumber}
üë§ Name: ${withdrawData.accountName}
‚è∞ Time: ${new Date().toLocaleString('id-ID')}
                `;
                
                console.log('üì§ Sending to admin bot:', message);
                // In production, send via Telegram Bot API
                
            } catch (error) {
                console.error('Send to bot error:', error);
            }
        }

        async function loadWithdrawalHistory() {
            if (!currentUser) return;

            try {
                const historyContainer = document.getElementById('withdrawalHistory');
                const snapshot = await db.collection('withdrawals')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .get();

                if (snapshot.empty) {
                    historyContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <i class="fas fa-receipt fa-3x" style="margin-bottom: 20px; opacity: 0.3;"></i>
                            <div>Belum ada riwayat penarikan</div>
                        </div>
                    `;
                    return;
                }

                let html = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.timestamp?.toDate() || new Date();
                    const formattedDate = date.toLocaleDateString('id-ID', {
                        day: '2-digit',
                        month: 'short',
                        year: 'numeric'
                    });
                    const formattedTime = date.toLocaleTimeString('id-ID', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    let statusColor = '#f59e0b';
                    let statusText = 'PENDING';
                    let statusClass = 'status-pending';

                    if (data.status === 'approved' || data.adminApproved === true) {
                        statusColor = '#43e97b';
                        statusText = 'SUCCESS';
                        statusClass = 'status-success';
                    } else if (data.status === 'rejected') {
                        statusColor = '#fa709a';
                        statusText = 'REJECTED';
                        statusClass = 'status-rejected';
                    }

                    html += `
                        <div class="history-item">
                            <div class="history-info">
                                <h4>${data.method || 'Unknown'}</h4>
                                <p>${formattedDate} ${formattedTime}</p>
                                <p>${data.accountNumber || ''} - ${data.accountName || ''}</p>
                            </div>
                            <div style="text-align: right;">
                                <div class="history-amount">Rp${data.amount?.toLocaleString('id-ID') || '0'}</div>
                                <div class="history-status ${statusClass}">${statusText}</div>
                            </div>
                        </div>
                    `;
                });

                historyContainer.innerHTML = html;

            } catch (error) {
                console.error('Load history error:', error);
            }
        }

        // üî• PROFILE FUNCTIONS
        function copyUserId() {
            navigator.clipboard.writeText(currentUser.uid).then(() => {
                showNotification('success', 'User ID berhasil disalin');
            });
        }

        async function changePassword() {
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            const errorDiv = document.getElementById('passwordError');
            const successDiv = document.getElementById('passwordSuccess');

            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            if (!oldPassword || !newPassword || !confirmPassword) {
                errorDiv.textContent = 'Semua field harus diisi';
                errorDiv.style.display = 'block';
                return;
            }

            if (newPassword.length < 6) {
                errorDiv.textContent = 'Password baru minimal 6 karakter';
                errorDiv.style.display = 'block';
                return;
            }

            if (newPassword !== confirmPassword) {
                errorDiv.textContent = 'Password baru tidak cocok';
                errorDiv.style.display = 'block';
                return;
            }

            try {
                // Reauthenticate user
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email,
                    oldPassword
                );
                
                await currentUser.reauthenticateWithCredential(credential);
                
                // Update password
                await currentUser.updatePassword(newPassword);
                
                successDiv.textContent = 'Password berhasil diubah!';
                successDiv.style.display = 'block';
                
                // Clear fields
                document.getElementById('oldPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmNewPassword').value = '';
                
                showNotification('success', 'Password berhasil diubah');
                
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                currentUser = null;
                userData = {};
                
                document.getElementById('appPage').style.display = 'none';
                document.getElementById('authPage').style.display = 'flex';
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
                
                // Clear form fields
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('referralCode').value = '';
                
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // üî• SHARE FUNCTIONS
        function copyReferralCode() {
            if (!referralCode) return;
            
            navigator.clipboard.writeText(referralCode).then(() => {
                const codeElement = document.getElementById('referralCodeDisplay');
                const originalText = codeElement.textContent;
                
                codeElement.textContent = '‚úÖ COPIED!';
                setTimeout(() => {
                    codeElement.textContent = originalText;
                }, 2000);
                
                showNotification('success', 'Kode referral berhasil disalin');
            });
        }

        function shareViaWhatsApp() {
            if (!referralCode) return;
            
            const text = `Halo! Bergabunglah dengan CASHREF menggunakan kode referral saya: ${referralCode}\n\nDapatkan bonus Rp100 saat mendaftar!`;
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function shareViaTelegram() {
            if (!referralCode) return;
            
            const text = `Halo! Bergabunglah dengan CASHREF menggunakan kode referral saya: ${referralCode}\n\nDapatkan bonus Rp100 saat mendaftar!`;
            const url = `https://t.me/share/url?url=&text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function copyReferralLink() {
            const link = `${window.location.origin}?ref=${referralCode}`;
            navigator.clipboard.writeText(link).then(() => {
                showNotification('success', 'Link referral berhasil disalin');
            });
        }

        function openShareModal() {
            const link = `${window.location.origin}?ref=${referralCode}`;
            document.getElementById('shareableLink').value = link;
            document.getElementById('shareModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('shareModal').style.display = 'none';
        }

        // üî• PAGE NAVIGATION
        function showPage(pageId) {
            // Hide all pages
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('referralPage').style.display = 'none';
            document.getElementById('withdrawPage').style.display = 'none';
            document.getElementById('historyPage').style.display = 'none';
            document.getElementById('profilePage').style.display = 'none';
            
            // Show selected page
            document.getElementById(pageId).style.display = 'block';
            
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const navItems = document.querySelectorAll('.nav-item');
            if (pageId === 'homePage') navItems[0].classList.add('active');
            else if (pageId === 'referralPage') navItems[1].classList.add('active');
            else if (pageId === 'withdrawPage') navItems[2].classList.add('active');
            else if (pageId === 'historyPage') navItems[3].classList.add('active');
            else if (pageId === 'profilePage') navItems[4].classList.add('active');
            
            // Load data for specific pages
            if (pageId === 'historyPage') {
                loadWithdrawalHistory();
            }
        }

        // üî• AUTO LOGIN CHECK
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserData().then(() => {
                    showApp();
                });
            }
        });

        // üî• INITIALIZE
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üî• CASHREF System Ready');
        });
    </script>
</body>
</html>